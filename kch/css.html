<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KCH CSS Gallery</title>
  <link rel="icon" type="image/png" href="assets/kch.webp">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7;
      --secondary: #a29bfe;
      --dark: #10131a;
      --light: #f8f9fa;
      --card-bg: rgba(25, 30, 45, 0.65);
      --glass-border: rgba(255, 255, 255, 0.1);
      --pastel-purple: #d8b9ff;
      --yellow-info: #f1c40f;
      --like-pink: #ff69b4;
      --success-green: #2ecc71;
      --error-red: #e74c3c;
      --showcase-tag: #0ecfe4;
      --free-tag: #2ecc71;
      --paid-tag: #ff99cc;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--dark);
      background-image: radial-gradient(circle at 10% 20%, rgba(108, 92, 231, 0.15) 0%, transparent 50%), radial-gradient(circle at 90% 80%, rgba(162, 155, 254, 0.15) 0%, transparent 50%);
      color: var(--light);
      min-height: 100vh;
      user-select: none;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
    }

    header {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 95%;
      max-width: 1500px;
      z-index: 1000;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      background: rgba(16, 19, 26, 0.8);
      border: 1px solid var(--glass-border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .header-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 25px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo img {
      height: 32px;
    }

    .logo h1 {
      font-size: 1.4rem;
      font-weight: 600;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    nav ul {
      display: flex;
      gap: 25px;
      list-style: none;
    }

    nav a {
      color: var(--light);
      text-decoration: none;
      font-weight: 500;
      position: relative;
      transition: color 0.3s;
    }

    nav a.active {
      color: var(--primary);
    }

    nav a:after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.3s;
    }

    nav a.active:after,
    nav a:hover:after {
      width: 100%;
    }

    main {
      padding-top: 100px;
    }

    .hero {
      padding: 40px 0;
      text-align: center;
    }

    .hero h2 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #ff79c6, #8a70ff, #50c4fa, #a0e8b7, #ffd166, #ff79c6);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: soapFilm 22s ease infinite;
      font-weight: 700;
    }

    @keyframes soapFilm {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .hero p {
      max-width: 700px;
      margin: 0 auto 30px;
      opacity: 0.8;
      line-height: 1.6;
    }

    .search-bar {
      max-width: 700px;
      margin: 0 auto 40px;
    }

    .search-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      align-items: center;
      position: relative;
      z-index: 6;
    }

    input[type="search"] {
      flex: 1;
      padding: 15px 20px;
      height: 48px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      color: var(--light);
      font-size: 1rem;
      backdrop-filter: blur(10px);
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.2s;
    }

    input[type="search"]:focus {
      border-top: none;
      border-right: 1px solid var(--primary);
      border-bottom: 2px solid var(--primary);
      border-left: 1px solid var(--primary);
      box-shadow: 0 2px 0 0 rgba(108, 92, 231, 0.2);
    }

    .disclaimer {
      text-align: center;
      margin-bottom: 40px;
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .tags-container {
      max-width: 700px;
      margin: 0 auto 20px;
      overflow-x: auto;
      white-space: nowrap;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .tags-container::-webkit-scrollbar {
      display: none;
    }

    .tag-item {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 30px;
      background: var(--card-bg);
      color: var(--light);
      font-size: 0.9rem;
      cursor: pointer;
      border: 1px solid var(--glass-border);
      margin-right: 10px;
      transition: all 0.3s;
    }

    .tag-item.selected {
      background: var(--primary);
      border-color: var(--primary);
    }

    .tag-item:hover {
      background: rgba(108, 92, 231, 0.2);
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
      padding-bottom: 60px;
    }

    .card-carousel {
      position: relative;
      overflow-x: auto;
      margin-bottom: 60px;
      white-space: nowrap;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    .card-carousel::-webkit-scrollbar {
      display: none;
    }

    .card-carousel::before,
    .card-carousel::after {
      content: '';
      position: absolute;
      top: 0;
      width: 100px;
      height: 100%;
      z-index: 10;
      pointer-events: none;
    }

    .card-carousel::before {
      left: 0;
      background: linear-gradient(to right, #10131af0 0%, transparent 100%);
    }

    .card-carousel::after {
      right: 0;
      background: linear-gradient(to left, #10131af0 0%, transparent 100%);
    }

    .card-carousel-inner {
      display: inline-flex;
      animation: scroll var(--scroll-duration, 40s) linear infinite;
    }

    .card-carousel-inner:hover {
      animation-play-state: paused !important;
    }

    @keyframes scroll {
      0% {
        transform: translateX(0);
      }

      100% {
        transform: translateX(-50%);
      }
    }

    .css-card {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      border: 1px solid var(--glass-border);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      width: 300px;
      margin-right: 30px;
      display: inline-block;
    }

    .css-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .css-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      object-position: top;
      border-bottom: 1px solid var(--glass-border);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .css-card img.loaded {
      opacity: 1;
    }

    .css-info {
      padding: 20px;
    }

    .css-info h3 {
      margin-bottom: 5px;
      font-size: 1.2rem;
    }

    .css-info .owner {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-bottom: 10px;
    }

    .css-info p {
      margin-bottom: 15px;
      font-size: 0.9rem;
      opacity: 0.7;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .css-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: var(--light);
    }

    .btn-primary:hover {
      box-shadow: 0 0 10px rgba(108, 92, 231, 0.5);
      transform: scale(1.05);
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--light);
      border: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
    }

    .btn-icon.liked {
      color: var(--like-pink);
      background: rgba(255, 105, 180, 0.2);
      border-color: var(--like-pink);
    }

    .btn-icon.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-icon.disabled:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: none;
      box-shadow: none;
    }

    .btn-source {
      background: rgba(255, 255, 255, 0.05);
      color: var(--light);
      border: 1px solid var(--glass-border);
    }

    .tag {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      margin: 0 5px 5px 0;
      display: inline-block;
      background: rgba(108, 92, 231, 0.2);
      color: var(--secondary);
    }

    .tag.free {
      background: rgba(46, 204, 113, 0.2);
      color: var(--free-tag);
    }

    .tag.paid {
      background: rgba(255, 153, 204, 0.2);
      color: var(--paid-tag);
    }

    .tag.showcase {
      background: rgba(39, 191, 208, 0.2);
      color: var(--showcase-tag);
    }

    footer {
      padding: 30px 0;
      text-align: center;
      border-top: 1px solid var(--glass-border);
      margin-top: 40px;
    }

    footer p {
      opacity: 0.7;
      font-size: 0.9rem;
    }

    footer a {
      color: var(--secondary);
      text-decoration: none;
    }

    .submit-section {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 16px;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
    }

    .submit-section h2 {
      font-size: 1.8rem;
      margin-bottom: 20px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .submit-section h3 {
      font-size: 1.2rem;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .submit-section ul {
      margin-bottom: 15px;
      opacity: 0.8;
      line-height: 1.6;
      list-style: disc;
      padding-left: 20px;
    }

    .submit-section ul li {
      margin-bottom: 10px;
    }

    .discord-info,
    .warning-box,
    .info-box {
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .discord-info {
      background: rgba(88, 101, 242, 0.15);
      border: 1px solid rgba(88, 101, 242, 0.3);
    }

    .warning-box {
      background: rgba(231, 76, 60, 0.15);
      border: 1px solid var(--error-red);
    }

    .info-box {
      background: rgba(241, 196, 15, 0.15);
      border: 1px solid rgba(241, 196, 15, 0.3);
    }

    .discord-info i {
      color: #5865F2;
    }

    .warning-box i,
    .info-box i {
      color: var(--yellow-info);
    }

    .discord-info a,
    .warning-box a,
    .info-box a {
      color: var(--pastel-purple);
      text-decoration: none;
      transition: color 0.3s;
    }

    .discord-info a:hover,
    .warning-box a:hover,
    .info-box a:hover {
      color: var(--secondary);
    }

    .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .preview-modal.active {
      display: flex;
      opacity: 1;
    }

    .preview-content {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 30px;
      max-width: 900px;
      width: 90%;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(10px);
      position: relative;
      transform: scale(0.8);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .preview-modal.active .preview-content {
      transform: scale(1);
      opacity: 1;
    }

    @keyframes modalClose {
      from {
        opacity: 1;
        transform: scale(1);
      }

      to {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    .preview-actions {
      position: absolute;
      top: 37px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .preview-content h2 {
      font-size: 2rem;
      margin-bottom: 20px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .preview-slider {
      position: relative;
      max-height: 70vh;
      overflow: hidden;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      backdrop-filter: blur(5px);
    }

    .preview-slider img {
      width: 100%;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 8px;
      background: #000;
      transform-origin: center;
      transition: transform 0.3s ease;
      opacity: 0;
      display: block;
    }

    .preview-slider img.active,
    .preview-slider img.loaded {
      opacity: 1;
    }

    .preview-slider .image-label {
      font-size: 1.1rem;
      margin-bottom: 10px;
      opacity: 0.9;
      text-align: center;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .preview-slider .image-error {
      font-size: 1.2rem;
      color: var(--light);
      background: rgba(231, 76, 60, 0.15);
      border: 1px solid var(--error-red);
      border-radius: 8px;
      text-align: center;
      display: none;
      padding: 20px;
      backdrop-filter: blur(5px);
    }

    .preview-slider .image-error.active {
      display: block;
    }

    .preview-slider .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      width: 100%;
      max-width: 4rem;
    }

    .preview-slider.grabbing {
      cursor: grabbing;
    }

    .preview-slider img.zoomed {
      cursor: grab;
    }

    .preview-slider img.zoomed.grabbing {
      cursor: grabbing;
    }

    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.8rem;
      color: var(--light);
      cursor: pointer;
      opacity: 0.7;
      padding: 10px;
      transition: opacity 0.3s;
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      backdrop-filter: blur(5px);
      display: none;
    }

    .preview-slider:has(#prev-arrow, #next-arrow) .arrow {
      display: block;
    }

    .arrow:hover {
      opacity: 1;
    }

    .arrow.left {
      left: 10px;
    }

    .arrow.right {
      right: 10px;
    }

    .preview-content .owner-link {
      display: block;
      text-align: center;
      margin-top: 15px;
      color: var(--pastel-purple);
      text-decoration: none;
      font-size: 0.9rem;
      opacity: 0.7;
      transition: all 0.3s;
    }

    .preview-content .owner-link:hover {
      color: var(--secondary);
      opacity: 0.9;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .search-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      width: calc(100% - 135px);
      background: var(--card-bg);
      border-radius: 0 0 12px 12px;
      border: 1px solid var(--glass-border);
      border-top: none;
      backdrop-filter: blur(10px);
      z-index: 100;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }

    .search-dropdown.active {
      max-height: 200px;
      overflow-y: auto;
    }

    .search-dropdown-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      cursor: pointer;
      transition: all 0.2s;
      border-bottom: 1px solid var(--glass-border);
    }

    .search-dropdown-item:hover {
      background: rgba(108, 92, 231, 0.1);
    }

    .search-dropdown-item .match-type {
      font-size: 0.8rem;
      color: rgba(189, 189, 189, 0.806);
    }

    .search-dropdown-item:last-child {
      border-bottom: none;
    }

    .availability-dropdown {
      min-width: 120px;
      height: 48px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      cursor: pointer;
      transition: border-color 0.3s, box-shadow 0.3s, transform 0.2s;
    }

    .availability-dropdown:hover {
      border-color: var(--primary);
      box-shadow: 0 0 8px rgba(108, 92, 231, 0.2);
      transform: translateY(-2px);
    }

    .dropdown-selected {
      padding: 0 35px 0 15px;
      height: 100%;
      display: flex;
      align-items: center;
      color: var(--light);
      font-size: 0.9rem;
      background: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E") no-repeat right 12px center;
      background-size: 12px;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      margin-top: 4px;
      max-height: 0;
      opacity: 0;
      transform: translateY(-10px);
      transition: max-height 0.3s ease, opacity 0.3s ease, transform 0.3s ease;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      pointer-events: none;
    }

    .availability-dropdown.open .dropdown-menu {
      max-height: 200px;
      opacity: 1;
      transform: translateY(0);
      backdrop-filter: blur(10px);
      pointer-events: auto;
    }

    .dropdown-item {
      padding: 6px 10px;
      color: var(--light);
      font-size: 0.9rem;
      transition: background 0.2s;
      border-bottom: 1px solid var(--glass-border);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: rgba(108, 92, 231, 0.251);
    }

    .error-popup,
    .success-popup {
      position: fixed;
      bottom: 6%;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      border-radius: 12px;
      padding: 15px 20px;
      color: var(--light);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 10px;
      backdrop-filter: blur(5px);
      z-index: 3000;
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .success-popup {
      background: rgba(46, 204, 113, 0.15);
      border: 1px solid var(--success-green);
    }

    .error-popup {
      background: rgba(231, 76, 60, 0.15);
      border: 1px solid var(--error-red);
    }

    .error-popup.active,
    .success-popup.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .error-popup i,
    .success-popup i {
      font-size: 1.2rem;
    }

    .success-popup i {
      color: var(--success-green);
    }

    .error-popup i {
      color: var(--yellow-info);
    }

    .loader {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 6rem;
      margin-top: 3rem;
      margin-bottom: 3rem;
    }

    .loader:before,
    .loader:after {
      content: "";
      position: absolute;
      border-radius: 50%;
      animation: pulsOut 1.8s ease-in-out infinite;
      filter: drop-shadow(0 0 1rem rgba(255, 255, 255, 0.75));
    }

    .loader:before {
      width: 100%;
      padding-bottom: 100%;
      box-shadow: inset 0 0 0 1rem #fff;
      animation-name: pulsIn;
    }

    .loader:after {
      width: calc(100% - 2rem);
      padding-bottom: calc(100% - 2rem);
      box-shadow: 0 0 0 0 #fff;
    }

    @keyframes pulsIn {
      0% {
        box-shadow: inset 0 0 0 1rem #fff;
        opacity: 1;
      }

      50%,
      100% {
        box-shadow: inset 0 0 0 0 #fff;
        opacity: 0;
      }
    }

    @keyframes pulsOut {

      0%,
      50% {
        box-shadow: 0 0 0 0 #fff;
        opacity: 0;
      }

      100% {
        box-shadow: 0 0 0 1rem #fff;
        opacity: 1;
      }
    }

    .css-card .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      margin: 0;
      width: 100%;
      max-width: 4rem;
    }

    .featured-star {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.5rem;
      color: var(--yellow-info);
      z-index: 1;
      animation: shimmer 2s infinite linear;
    }

    .zoom-level {
      background: var(--card-bg);
      color: var(--light);
      padding: 5px 10px;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
      font-size: 0.9rem;
      margin: 0 5px;
      min-width: 60px;
      text-align: center;
    }

    .card-carousel.search-active::before,
    .card-carousel.search-active::after {
      display: none;
    }

    .card-carousel-inner.search-active {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      animation: none !important;
    }

    .card-carousel-inner.search-active .css-card {
      margin-right: 0;
    }

    @keyframes shimmer {
      0% {
        filter: brightness(1) drop-shadow(0 0 2px rgba(241, 196, 15, 0.5));
      }

      50% {
        filter: brightness(1.5) drop-shadow(0 0 8px rgba(241, 196, 15, 0.8));
      }

      100% {
        filter: brightness(1) drop-shadow(0 0 2px rgba(241, 196, 15, 0.5));
      }
    }

    .tooltip {
      position: absolute;
      top: 100%;
      left: 70%;
      transform: translateX(-50%);
      background: var(--card-bg);
      color: var(--light);
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--glass-border);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      z-index: 10;
    }

    .btn-icon.disabled:hover .tooltip,
    .btn-icon.showcase:hover .tooltip {
      opacity: 1;
      visibility: visible;
    }

    .filter-container {
      max-width: 700px;
      margin: 0 auto 40px;
    }

    .availability-container {
      margin-bottom: 20px;
      position: relative;
      z-index: 10;
    }

    .hamburger {
      display: none;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 10px;
      z-index: 1001;
    }

    nav {
      transition: transform 0.3s ease;
    }

    .tags-container-wrapper {
      position: relative;
      max-width: 700px;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
    }

    .tag-scroll-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--card-bg);
      color: var(--light);
      border: 1px solid var(--glass-border);
      transition: all 0.3s;
      z-index: 5;
      flex-shrink: 0;
      opacity: 0.8;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      margin-bottom: 19px;
    }

    .tag-scroll-btn:hover {
      background: rgba(108, 92, 231, 0.2);
      transform: scale(1.1);
      opacity: 1;
    }

    .tag-scroll-left {
      margin-right: 10px;
    }

    .tag-scroll-right {
      margin-left: 10px;
    }

    @media (max-width: 768px) {
      .tag-scroll-btn {
        width: 30px;
        height: 30px;
        font-size: 0.8rem;
      }

      .hamburger {
        display: block;
      }

      nav {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: rgba(16, 19, 26, 0.95);
        border-radius: 0 0 16px 16px;
        border: 1px solid var(--glass-border);
        border-top: none;
        transform: translateY(-100%);
        visibility: hidden;
        opacity: 0;
      }

      nav.active {
        transform: translateY(0);
        visibility: visible;
        opacity: 1;
      }

      nav ul {
        flex-direction: column;
        align-items: center;
        padding: 20px;
        gap: 15px;
      }

      nav a {
        font-size: 1.1rem;
        padding: 10px;
        width: 100%;
        text-align: center;
      }

      .header-container {
        justify-content: space-between;
        align-items: center;
      }

      .hero h2 {
        font-size: 2rem;
      }

      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
      }

      .search-container {
        flex-direction: column;
        align-items: stretch;
      }

      header {
        top: 10px;
      }

      .preview-content {
        width: 95%;
        padding: 20px;
      }

      .preview-slider,
      .preview-slider img {
        max-height: 50vh;
      }

      .preview-slider .image-error {
        font-size: 1rem;
      }

      .arrow {
        font-size: 1.5rem;
        width: 36px;
        height: 36px;
      }

      .css-card {
        width: 250px;
        margin-right: 20px;
      }

      .search-dropdown {
        width: 100%;
        top: calc(100% - 15px);
      }

      input[type="search"],
      .availability-dropdown {
        width: 100%;
      }

      .error-popup,
      .success-popup {
        width: 90%;
        font-size: 0.8rem;
        padding: 12px 15px;
      }
    }

    @media (max-width: 585px) {
      .preview-content h2 {
        font-size: 1.6rem;
        margin-bottom: 40px;
      }

      .preview-actions {
        margin-top: 20px;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-container">
      <div class="logo">
        <img src="assets/kirka.webp" alt="Kirka">
        <h1>KCH CSS Gallery</h1>
      </div>
      <button class="hamburger" id="hamburger">
        <i class="fas fa-bars"></i>
      </button>
      <nav id="nav-menu">
        <ul>
          <li><a href="#home" class="active">Home</a></li>
          <li><a href="#featured">Featured</a></li>
          <li><a href="#all">All</a></li>
          <li><a href="#liked">Liked</a></li>
          <li><a href="#submit">Submit CSS</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main>
    <div class="container">
      <section id="home" class="tab-content active">
        <section class="hero">
          <h2>Enhance Your Kirka Experience</h2>
          <p>Discover and download custom CSS files to personalize your gameplay.</p>
        </section>
        <section class="search-bar">
          <div class="search-container">
            <input type="search" id="css-search" placeholder="Search CSS files">
            <div class="availability-dropdown" id="availability-dropdown">
              <div class="dropdown-selected">All</div>
              <div class="dropdown-menu">
                <div class="dropdown-item" data-value="all">All</div>
                <div class="dropdown-item" data-value="free">Free</div>
                <div class="dropdown-item" data-value="paid">Paid</div>
                <div class="dropdown-item" data-value="showcase">Showcase</div>
              </div>
            </div>
            <div class="search-dropdown" id="search-dropdown"></div>
          </div>
          <div class="tags-container-wrapper">
            <button class="tag-scroll-btn tag-scroll-left"><i class="fas fa-chevron-left"></i></button>
            <div class="tags-container" id="tags-container"></div>
            <button class="tag-scroll-btn tag-scroll-right"><i class="fas fa-chevron-right"></i></button>
          </div>
          <div class="disclaimer">
            License Warning: All 'free' CSS are free for personal use but may not be redistributed or claimed as your
            own unless prior consent is obtained from the original creator.
          </div>
        </section>
        <section class="card-carousel" id="home-carousel">
          <div class="card-carousel-inner" id="carousel-inner"></div>
        </section>
      </section>
      <section id="featured" class="tab-content">
        <section class="hero">
          <h2>Featured CSS Themes</h2>
          <p>Explore the finest handpicked themes.</p>
        </section>
        <section class="gallery" id="featured-gallery"></section>
      </section>
      <section id="liked" class="tab-content">
        <section class="hero">
          <h2>Liked CSS Themes</h2>
          <p>View all the CSS themes you've liked.</p>
        </section>
        <section class="gallery" id="liked-gallery"></section>
      </section>
      <section id="all" class="tab-content">
        <section class="hero">
          <h2>All CSS Themes</h2>
          <p>Browse the complete collection of CSS themes for Kirka.</p>
          <section class="filter-container">
            <div class="availability-container">
              <div class="availability-dropdown" id="all-availability-dropdown">
                <div class="dropdown-selected">All</div>
                <div class="dropdown-menu">
                  <div class="dropdown-item" data-value="all">All</div>
                  <div class="dropdown-item" data-value="free">Free</div>
                  <div class="dropdown-item" data-value="paid">Paid</div>
                  <div class="dropdown-item" data-value="showcase">Showcase</div>
                </div>
              </div>
            </div>
            <div class="tags-container-wrapper">
              <button class="tag-scroll-btn tag-scroll-left"><i class="fas fa-chevron-left"></i></button>
              <div class="tags-container" id="all-tags-container"></div>
              <button class="tag-scroll-btn tag-scroll-right"><i></i></span></button>
            </div>
          </section>
        </section>
        <section class="gallery" id="all-gallery"></section>
      </section>
      <section id="submit" class="tab-content">
        <section class="submit-section">
          <h2>Submit Your CSS</h2>
          <div class="discord-info">
            <i class="fab fa-discord"></i>
            <span>Contact <a href="https://discord.com/users/884448772694876191" target="_blank">punitxsingh</a> to get
              your CSS hosted here.</span>
          </div>
          <h3>Submissions must meet these requirements:</h3>
          <ul>
            <li><span>CSS Code – Submit raw CSS file/direct github raw file link without any locally loaded assets.</li>
            <li><span>Tags – Include three relevant tags (e.g., minimal, cyberpunk, dark).</span></li>
            <li><span>Availability Tag – Specify availability of your submission using tags: free, paid or
                showcase.</span></li>
            <li><span>Unique URL – Name – Give your theme a distinct and original name.</li>
            <li><span>Short Description – Include a concise summary of your CSS theme (optional).</span></li>
            <li><span>Preview Screenshots – Submit images for preview, one of the home screen and one from in-game to be
                showcased.</span></li>
            <li><span>Discord Contact – Share your Discord in this format: https://discord.com/users/your_user_id</li>
            <li><span>Username – Provide a unique username to identify your submission.</li>
            <li><span>Paid – For paid CSS, CSS users will contact you directly via your provided Discord contact and for
                css submission you don’t have to include your css file.</li>
          </ul>
          <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <span>Your CSS will be uploaded within 1 day to a week.</span>
          </div>
          <div class="warning-box">
            <i class="fas fa-exclamation-triangle"></i>
            <span>This platform does not verify the originality of each submission. If someone has uploaded a copied or
              stolen CSS file under their name, we are not responsible. If you believe your work has been submitted
              without credit or permission, please contact <a href="https://discord.com/users/884448772694876191"
                target="_blank">punitxsingh</a> to have it reviewed and removed.</span>
          </div>
        </section>
      </section>
    </div>
  </main>
  <div class="preview-modal" id="preview-modal">
    <div class="preview-content">
      <div class="preview-header">
        <h2 id="preview-title"></h2>
        <div class="preview-actions">
          <button class="btn-icon preview-btn" id="preview-zoom-out"><i class="fas fa-minus"></i></button>
          <span class="zoom-level" id="zoom-level-display">100%</span>
          <button class="btn-icon preview-btn" id="preview-zoom-in"><i class="fas fa-plus"></i></button>
        </div>
        <div class="preview-slider">
          <div class="image-label" id="preview-label"></div>
          <img id="preview-image" src="" alt="Preview">
          <div class="loader" id="preview-loader"></div>
          <div class="image-error" id="image-error">Image not found!</div>
          <i class="fas fa-chevron-left arrow left" id="prev-arrow"></i>
          <i class="fas fa-chevron-right arrow right" id="next-arrow"></i>
        </div>
        <a href="#" id="preview-owner" class="owner-link"></a>
      </div>
    </div>
    <div class="error-popup" id="error-popup">
      <i class="fas fa-exclamation-triangle"></i>
      <span>User not found! No Discord contact provided.</span>
    </div>
    <div class="success-popup" id="success-popup">
      <i class="fas fa-check-circle"></i>
      <span>Theme liked!</span>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      let items = [];
      let likedCSSTitles = [];
      const jsonFile = 'https://raw.githubusercontent.com/imnotkoolkid/KCH/refs/heads/main/data/css.json';

      try {
        const settings = window.obsidianClient.getSettings();
        likedCSSTitles = settings.likedCSSTitles || [];
      } catch (err) {
        console.error('Error loading settings:', err);
      }

      const saveLikedCSSTitles = (titles) => {
        try {
          window.obsidianClient.saveSettings({ likedCSSTitles: titles });
          likedCSSTitles = titles;
        } catch (err) {
          console.error('Error saving liked CSS titles:', err);
        }
      };

      try {
        const response = await fetch(jsonFile);
        if (!response.ok) throw new Error('Failed to load CSS data');
        items = await response.json();
      } catch (error) {
        console.error('Error loading CSS data:', error);
        document.getElementById('carousel-inner').innerHTML = `<div class="css-card"><div class="css-info"><h3>Error</h3><p>Failed to load CSS themes: ${error.message}</p></div></div>`;
        return;
      }

      const showSuccessPopup = (message = 'Theme liked!') => {
        const popup = document.getElementById('success-popup');
        popup.querySelector('span').textContent = message;
        popup.classList.add('active');
        setTimeout(() => popup.classList.remove('active'), 3000);
      };

      const showErrorPopup = (message = 'User not found! No Discord contact provided.') => {
        const popup = document.getElementById('error-popup');
        popup.querySelector('span').textContent = message;
        popup.classList.add('active');
        setTimeout(() => popup.classList.remove('active'), 3000);
      };

      const createCardElement = (item) => {
        const cardElement = document.createElement('div');
        const isLiked = likedCSSTitles.includes(item.title);
        cardElement.className = 'css-card';
        cardElement.innerHTML = `
                    <div style="position: relative;">
                        <img src="${item.homeImage || 'files/paid/eg1.png'}" alt="${item.title} CSS">
                        ${item.label === 'featured' ? '<i class="fas fa-star featured-star"></i>' : ''}
                        <div class="loader"></div>
                    </div>
                    <div class="css-info">
                        <h3>${item.title}</h3>
                        <div class="owner">by ${item.owner}</div>
                        <p>${item.description}</p>
                        <div class="tags">
                            ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            <span class="tag ${item.availability}">${item.availability}</span>
                        </div>
                        <div class="css-actions">
                            ${item.availability === 'free' && item.downloadUrl ? `
                                <button class="btn btn-primary" data-download="${item.downloadUrl}" data-title="${item.title}">Apply</button>
                            ` : `
                                <button class="btn btn-primary disabled" title="${item.availability === 'paid' ? 'Contact owner to get paid CSS' : 'Only for showcase'}">${item.availability === 'paid' ? 'Paid' : 'Showcase'}</button>
                            `}
                            <button class="btn btn-icon btn-like ${isLiked ? 'liked' : ''}" data-title="${item.title}" title="${isLiked ? 'Unlike' : 'Like'}">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    </div>
                `;
        const img = cardElement.querySelector('img');
        const loader = cardElement.querySelector('.loader');
        if (img.src && img.src !== window.location.href) {
          img.onload = () => {
            img.classList.add('loaded');
            loader.style.display = 'none';
          };
          img.onerror = () => {
            img.classList.add('loaded');
            loader.style.display = 'none';
          };
        } else {
          img.classList.add('loaded');
          loader.style.display = 'none';
        }
        cardElement.addEventListener('click', e => {
          if (e.target.closest('.btn-primary[data-download]')) {
            if (item.availability === 'free' && item.downloadUrl) {
              window.obsidianClient?.injectKCHCSS(item.downloadUrl, item.title);
            }
          } else if (e.target.closest('.btn-like')) {
            const likeButton = e.target.closest('.btn-like');
            const title = likeButton.dataset.title;
            const isCurrentlyLiked = likedCSSTitles.includes(title);
            if (isCurrentlyLiked) {
              const newLikes = likedCSSTitles.filter(t => t !== title);
              saveLikedCSSTitles(newLikes);
              likeButton.classList.remove('liked');
              likeButton.querySelector('i').className = 'fas fa-heart';
              likeButton.title = 'Like';
              showSuccessPopup('Theme unliked!');
              updateLikedGallery(); 
            } else {
              const newLikes = [...likedCSSTitles, title];
              saveLikedCSSTitles(newLikes);
              likeButton.classList.add('liked');
              likeButton.querySelector('i').className = 'fas fa-heart';
              likeButton.title = 'Unlike';
              showSuccessPopup('Theme liked!');
              updateLikedGallery(); 
            }
          } else {
            showPreview(item);
          }
        });
        return cardElement;
      };

      const renderCarousel = (filterValue = 'all') => {
        const carousel = document.getElementById('home-carousel');
        const carouselInner = document.getElementById('carousel-inner');
        carouselInner.innerHTML = '';
        carousel.classList.remove('search-active');
        carouselInner.classList.remove('search-active');
        const filteredItems = filterValue === 'all' ? items : items.filter(item => item.availability === filterValue);
        [...filteredItems, ...filteredItems].forEach(item => {
          carouselInner.appendChild(createCardElement(item));
        });
        const cardCount = filteredItems.length * 2;
        const scrollDuration = cardCount * 4;
        carouselInner.style.setProperty('--scroll-duration', `${scrollDuration}s`);
        carouselInner.style.animation = `scroll ${scrollDuration}s linear infinite`;
      };

      const renderCards = (galleryId, filterLabel) => {
        if (galleryId === 'all-gallery') {
          updateAllGalleryResults();
          return;
        } else if (galleryId === 'liked-gallery') {
          updateLikedGallery();
          return;
        }
        const gallery = document.getElementById(galleryId);
        gallery.innerHTML = '';
        const filteredItems = filterLabel === 'all' ? items : items.filter(item => item.label === filterLabel);
        if (filteredItems.length === 0) {
          gallery.innerHTML = `<div class="css-card"><div class="css-info"><h3>No results found</h3><p>Try different filters or tags</p></div></div>`;
          return;
        }
        filteredItems.forEach(item => gallery.appendChild(createCardElement(item)));
      };

      const renderTags = () => {
        const tagsContainers = [
          { container: document.getElementById('tags-container'), section: 'home' },
          { container: document.getElementById('all-tags-container'), section: 'all' }
        ];
        const uniqueTags = [...new Set(items.flatMap(item => item.tags))].sort();
        tagsContainers.forEach(({ container, section }) => {
          if (!container) return;
          container.innerHTML = uniqueTags.map(tag => `<span class="tag-item" data-tag="${tag}" data-section="${section}">${tag}</span>`).join('');
          container.addEventListener('wheel', e => {
            e.preventDefault();
            container.scrollLeft += e.deltaY;
          });
          container.querySelectorAll('.tag-item').forEach(tagItem => {
            tagItem.addEventListener('click', () => {
              tagItem.classList.toggle('selected');
              if (section === 'home') {
                updateSearchResults();
              } else {
                updateAllGalleryResults();
              }
            });
          });
        });
      };

      const updateSearchResults = () => {
        const searchInput = document.getElementById('css-search');
        const searchDropdown = document.getElementById('search-dropdown');
        const carousel = document.getElementById('home-carousel');
        const carouselInner = document.getElementById('carousel-inner');
        const searchTerm = searchInput.value.toLowerCase().trim();
        const selectedTags = Array.from(document.querySelectorAll('#tags-container .tag-item.selected')).map(tag => tag.dataset.tag);
        const availabilityDropdown = document.getElementById('availability-dropdown');
        const dropdownSelected = availabilityDropdown.querySelector('.dropdown-selected');
        const currentFilter = dropdownSelected.textContent.toLowerCase();
        const isSearchActive = searchTerm.length >= 2 || selectedTags.length > 0;
        carousel.classList.toggle('search-active', isSearchActive);
        carouselInner.classList.toggle('search-active', isSearchActive);

        if (!isSearchActive) {
          searchDropdown.classList.remove('active');
          searchDropdown.innerHTML = '';
          renderCarousel(currentFilter);
          return;
        }

        const filteredItems = items
          .map(item => {
            let matchType = null;
            let score = 0;
            const titleLower = item.title.toLowerCase();
            if (titleLower === searchTerm) {
              score = 100;
              matchType = 'css';
            } else if (titleLower.startsWith(searchTerm)) {
              score = 90;
              matchType = 'css';
            } else if (titleLower.includes(searchTerm)) {
              score = 80;
              matchType = 'css';
            }
            if (!matchType && searchTerm.length >= 2) {
              const descriptionLower = item.description.toLowerCase();
              const tagsLower = item.tags.map(tag => tag.toLowerCase());
              if (descriptionLower.includes(searchTerm)) {
                score = 70;
                matchType = 'suggested';
              } else if (tagsLower.some(tag => tag.includes(searchTerm))) {
                score = 60;
                matchType = 'suggested';
              }
            }
            if (!matchType && searchTerm.length >= 2) {
              const ownerLower = item.owner.toLowerCase();
              if (ownerLower.includes(searchTerm)) {
                score = 50;
                matchType = 'creator';
              }
            }
            const matchesTags = selectedTags.length === 0 || selectedTags.every(tag => item.tags.includes(tag));
            const matchesAvailability = currentFilter === 'all' || item.availability === currentFilter;
            return { item, matchType, score, matchesTags, matchesAvailability };
          })
          .filter(({ score, matchesTags, matchesAvailability }) => score > 0 && matchesTags && matchesAvailability)
          .sort((a, b) => b.score - a.score)
          .map(({ item }) => item);

        carouselInner.innerHTML = '';
        carouselInner.style.animation = 'none';
        if (filteredItems.length === 0) {
          carouselInner.innerHTML = `
                        <div class="css-card">
                            <div class="css-info">
                                <h3>No results found</h3>
                                <p>Try different search terms or filters</p>
                            </div>
                        </div>
                    `;
          searchDropdown.classList.remove('active');
          return;
        }

        filteredItems.forEach(item => {
          carouselInner.appendChild(createCardElement(item));
        });

        if (searchTerm.length >= 2) {
          searchDropdown.innerHTML = '';
          const dropdownItems = items
            .map(item => {
              let matchType = null;
              let score = 0;
              const titleLower = item.title.toLowerCase();
              const descriptionLower = item.description.toLowerCase();
              const tagsLower = item.tags.map(tag => tag.toLowerCase());
              const ownerLower = item.owner.toLowerCase();
              if (titleLower === searchTerm) {
                score = 100;
                matchType = 'css';
              } else if (titleLower.startsWith(searchTerm)) {
                score = 90;
                matchType = 'css';
              } else if (titleLower.includes(searchTerm)) {
                score = 80;
                matchType = 'css';
              }
              if (!matchType) {
                if (descriptionLower.includes(searchTerm)) {
                  score = 70;
                  matchType = 'suggested';
                } else if (tagsLower.some(tag => tag.includes(searchTerm))) {
                  score = 60;
                  matchType = 'suggested';
                }
              }
              if (!matchType && ownerLower.includes(searchTerm)) {
                score = 50;
                matchType = 'creator';
              }
              return { item, matchType, score };
            })
            .filter(({ score }) => score > 0)
            .sort((a, b) => b.score - a.score)
            .slice(0, 3);

          dropdownItems.forEach(({ item, matchType }) => {
            const dropdownItem = document.createElement('div');
            dropdownItem.className = `search-dropdown-item search-match-${matchType}`;
            dropdownItem.innerHTML = `
                            <span>${matchType === 'creator' ? item.owner : item.title}</span>
                            <span class="match-type">(${matchType})</span>
                        `;
            dropdownItem.addEventListener('click', () => {
              searchInput.value = matchType === 'creator' ? item.owner : item.title;
              searchDropdown.classList.remove('active');
              updateSearchResults();
            });
            searchDropdown.appendChild(dropdownItem);
          });

          searchDropdown.classList.toggle('active', dropdownItems.length > 0);
        } else {
          searchDropdown.classList.remove('active');
        }
      };

      const updateAllGalleryResults = () => {
        const gallery = document.getElementById('all-gallery');
        const selectedTags = Array.from(document.querySelectorAll('#all-tags-container .tag-item.selected')).map(tag => tag.dataset.tag);
        const availabilityDropdown = document.getElementById('all-availability-dropdown');
        const dropdownSelected = availabilityDropdown.querySelector('.dropdown-selected');
        const currentFilter = dropdownSelected.textContent.toLowerCase();
        const filteredItems = items.filter(item =>
          (currentFilter === 'all' || item.availability === currentFilter) &&
          (selectedTags.length === 0 || selectedTags.every(tag => item.tags.includes(tag)))
        );
        gallery.innerHTML = '';
        if (filteredItems.length === 0) {
          gallery.innerHTML = `
                        <div class="css-card">
                            <div class="css-info">
                                <h3>No results found</h3>
                                <p>Try different filters or tags</p>
                            </div>
                        </div>
                    `;
          return;
        }
        filteredItems.forEach(item => {
          gallery.appendChild(createCardElement(item));
        });
      };

      const updateLikedGallery = () => {
        const gallery = document.getElementById('liked-gallery');
        gallery.innerHTML = '';
        const filteredItems = items.filter(item => likedCSSTitles.includes(item.title));
        if (filteredItems.length === 0) {
          gallery.innerHTML = `
                        <div class="css-card">
                            <div class="css-info">
                                <h3>No liked themes</h3>
                                <p>Like some CSS themes to see them here!</p>
                            </div>
                        </div>
                    `;
          return;
        }
        filteredItems.forEach(item => {
          gallery.appendChild(createCardElement(item));
        });
      };

      const showPreview = item => {
        const modal = document.getElementById('preview-modal');
        const title = document.getElementById('preview-title');
        const image = document.getElementById('preview-image');
        const loader = document.getElementById('preview-loader');
        const error = document.getElementById('image-error');
        const label = document.getElementById('preview-label');
        const ownerLink = document.getElementById('preview-owner');
        const prevArrow = document.getElementById('prev-arrow');
        const nextArrow = document.getElementById('next-arrow');
        const scrollPosition = window.scrollY;
        let images = [
          { src: item.homeImage, label: 'Home Screen' },
          { src: item.ingameImage, label: 'In Game' }
        ];
        let currentIndex = 0;

        const encodedTitle = encodeURIComponent(item.title.replace(/\s+/g, '-').toLowerCase());
        history.pushState(null, '', `#${encodedTitle}`);
        title.textContent = item.title;

        ownerLink.textContent = `by ${item.owner}`;
        ownerLink.href = item.discord || '#';
        ownerLink.onclick = e => {
          if (!item.discord || item.discord.trim() === '' || item.discord === '#') {
            e.preventDefault();
            showErrorPopup();
            return false;
          }
        };

        const updateImage = () => {
          resetZoom();
          const { src, label: imgLabel } = images[currentIndex];
          label.textContent = imgLabel;
          image.src = '';
          image.classList.remove('loaded');
          loader.style.display = 'flex';
          error.classList.remove('active');
          if (src && src.trim()) {
            image.src = src;
            image.onload = () => {
              image.classList.add('loaded');
              loader.style.display = 'none';
              image.classList.add('active');
            };
            image.onerror = () => {
              image.classList.remove('loaded');
              loader.style.display = 'none';
              error.classList.add('active');
            };
          } else {
            image.classList.remove('loaded');
            loader.style.display = 'none';
            error.classList.add('active');
          }
        };

        updateImage();

        prevArrow.onclick = () => {
          currentIndex = (currentIndex - 1 + images.length) % images.length;
          updateImage();
        };
        nextArrow.onclick = () => {
          currentIndex = (currentIndex + 1) % images.length;
          updateImage();
        };

        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('active'), 10);
      };

      const image = document.getElementById('preview-image');
      const zoomInButton = document.getElementById('preview-zoom-in');
      const zoomOutButton = document.getElementById('preview-zoom-out');
      const zoomLevelDisplay = document.getElementById('zoom-level-display');
      const previewSlider = document.querySelector('.preview-slider');
      let zoomLevel = 1;
      const maxZoom = 3;
      const minZoom = 0.5;
      let isDragging = false;
      let startX, startY, translateX = 0, translateY = 0;

      const updateZoomDisplay = () => {
        zoomLevelDisplay.textContent = `${Math.round(zoomLevel * 100)}%`;
      };

      const updateZoom = () => {
        if (zoomLevel <= 1) {
          translateX = 0;
          translateY = 0;
        }
        image.style.transform = `scale(${zoomLevel}) translate(${translateX}px, ${translateY}px)`;
        image.classList.toggle('zoomed', zoomLevel > 1);
      };

      const resetZoom = () => {
        zoomLevel = 1;
        translateX = 0;
        translateY = 0;
        updateZoom();
        updateZoomDisplay();
      };

      zoomInButton.onclick = () => {
        if (zoomLevel < maxZoom) {
          zoomLevel = Math.min(zoomLevel + 0.1, maxZoom);
          updateZoom();
          updateZoomDisplay();
        }
      };

      zoomOutButton.onclick = () => {
        if (zoomLevel > minZoom) {
          zoomLevel = Math.max(zoomLevel - 0.1, minZoom);
          updateZoom();
          updateZoomDisplay();
        }
      };

      previewSlider.addEventListener('wheel', (e) => {
        e.preventDefault();
        if (e.deltaY < 0 && zoomLevel < maxZoom) {
          zoomLevel = Math.min(zoomLevel + 0.1, maxZoom);
        } else if (e.deltaY > 0 && zoomLevel > minZoom) {
          zoomLevel = Math.max(zoomLevel - 0.1, minZoom);
        }
        updateZoom();
        updateZoomDisplay();
      });

      image.addEventListener('mousedown', (e) => {
        if (zoomLevel > 1) {
          e.preventDefault();
          isDragging = true;
          startX = e.clientX - translateX;
          startY = e.clientY - translateY;
          image.classList.add('grabbing');
          previewSlider.classList.add('grabbing');
        }
      });

      document.addEventListener('mousemove', (e) => {
        if (isDragging) {
          translateX = e.clientX - startX;
          translateY = e.clientY - startY;
          updateZoom();
        }
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        image.classList.remove('grabbing');
        previewSlider.classList.remove('grabbing');
      });

      image.addEventListener('touchstart', (e) => {
        if (zoomLevel > 1) {
          isDragging = true;
          startX = e.touches[0].clientX - translateX;
          startY = e.touches[0].clientY - translateY;
          image.classList.add('grabbing');
          previewSlider.classList.add('grabbing');
        }
      });

      document.addEventListener('touchmove', (e) => {
        if (isDragging) {
          translateX = e.touches[0].clientX - startX;
          translateY = e.touches[0].clientY - startY;
          updateZoom();
        }
      });

      document.addEventListener('touchend', () => {
        isDragging = false;
        image.classList.remove('grabbing');
        previewSlider.classList.remove('grabbing');
      });

      resetZoom();

      document.getElementById('preview-modal').onclick = e => {
        if (e.target === e.currentTarget) {
          const modal = e.currentTarget;
          const content = modal.querySelector('.preview-content');
          modal.classList.remove('active');
          content.style.animation = 'modalClose 0.3s ease forwards';
          setTimeout(() => {
            modal.style.display = 'none';
            content.style.animation = '';
            history.pushState(null, '', window.location.pathname);
            window.scrollTo(0, window.scrollY);
          }, 300);
        }
      };

      const handleHash = () => {
        const hash = window.location.hash;
        if (hash) {
          const cardTitle = decodeURIComponent(hash.substring(1)).replace(/-/g, ' ').toLowerCase();
          const item = items.find(c => c.title.toLowerCase() === cardTitle);
          if (item) showPreview(item);
          else window.location.hash = '';
        } else {
          document.getElementById('preview-modal').style.display = 'none';
        }
      };

      handleHash();
      window.addEventListener('hashchange', handleHash);

      const searchInput = document.getElementById('css-search');
      const searchDropdown = document.getElementById('search-dropdown');
      const availabilityDropdown = document.getElementById('availability-dropdown');
      const dropdownSelected = availabilityDropdown.querySelector('.dropdown-selected');
      const dropdownMenu = availabilityDropdown.querySelector('.dropdown-menu');
      const dropdownItems = dropdownMenu.querySelectorAll('.dropdown-item');
      let currentFilter = 'all';

      availabilityDropdown.addEventListener('click', e => {
        availabilityDropdown.classList.toggle('open');
        e.stopPropagation();
      });

      dropdownItems.forEach(item => {
        item.addEventListener('click', e => {
          const value = item.getAttribute('data-value');
          dropdownSelected.textContent = item.textContent;
          currentFilter = value;
          dropdownItems.forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          availabilityDropdown.classList.remove('open');
          updateSearchResults();
          e.stopPropagation();
        });
      });

      document.addEventListener('click', e => {
        if (!availabilityDropdown.contains(e.target)) availabilityDropdown.classList.remove('open');
      });

      searchInput.addEventListener('input', updateSearchResults);

      document.addEventListener('click', e => {
        if (!e.target.closest('#css-search') && !e.target.closest('#search-dropdown')) {
          searchDropdown.classList.remove('active');
        }
      });

      const allAvailabilityDropdown = document.getElementById('all-availability-dropdown');
      const allDropdownSelected = allAvailabilityDropdown.querySelector('.dropdown-selected');
      const allDropdownMenu = allAvailabilityDropdown.querySelector('.dropdown-menu');
      const allDropdownItems = allDropdownMenu.querySelectorAll('.dropdown-item');

      allAvailabilityDropdown.addEventListener('click', e => {
        allAvailabilityDropdown.classList.toggle('open');
        e.stopPropagation();
      });

      allDropdownItems.forEach(item => {
        item.addEventListener('click', e => {
          const value = item.getAttribute('data-value');
          allDropdownSelected.textContent = item.textContent;
          allDropdownItems.forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          allAvailabilityDropdown.classList.remove('open');
          updateAllGalleryResults();
          e.stopPropagation();
        });
      });

      document.addEventListener('click', e => {
        if (!allAvailabilityDropdown.contains(e.target)) allAvailabilityDropdown.classList.remove('open');
      });

      renderCarousel();
      renderCards('featured-gallery', 'featured');
      renderCards('liked-gallery', 'liked');
      renderCards('all-gallery', 'all');
      renderTags();

      document.querySelectorAll('nav a').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault();
          document.querySelectorAll('nav a').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
          const targetId = link.getAttribute('href').substring(1);
          document.querySelectorAll('.tab-content').forEach(content => content.classList.toggle('active', content.id === targetId));
          renderCarousel(document.getElementById('availability-dropdown').querySelector('.dropdown-selected').textContent.toLowerCase());
          renderCards('featured-gallery', 'featured');
          renderCards('liked-gallery', 'liked');
          renderCards('all-gallery', 'all');
        });
      });

      const hamburger = document.getElementById('hamburger');
      const navMenu = document.getElementById('nav-menu');

      hamburger.addEventListener('click', () => {
        navMenu.classList.toggle('active');
        hamburger.innerHTML = navMenu.classList.contains('active')
          ? '<i class="fas fa-times"></i>'
          : '<i class="fas fa-bars"></i>';
      });

      navMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          navMenu.classList.remove('active');
          hamburger.innerHTML = '<i class="fas fa-bars"></i>';
        });
      });

      function initTagScroll() {
        const containers = document.querySelectorAll('.tags-container-wrapper');
        containers.forEach(wrapper => {
          const container = wrapper.querySelector('.tags-container');
          const leftBtn = wrapper.querySelector('.tag-scroll-left');
          const rightBtn = wrapper.querySelector('.tag-scroll-right');
          if (!container || !leftBtn || !rightBtn) return;
          leftBtn.addEventListener('click', () => {
            container.scrollBy({ left: -200, behavior: 'smooth' });
          });
          rightBtn.addEventListener('click', () => {
            container.scrollBy({ left: 200, behavior: 'smooth' });
          });
        });
      }

      initTagScroll();
    });
  </script>
</body>

</html>
